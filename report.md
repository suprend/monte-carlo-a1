# Отчёт по лабораторной работе
## Вычисление площади пересечения трёх окружностей методом Монте-Карло

---

## 1. Цель работы

Вычислить площадь фигуры, образованной пересечением трёх заданных окружностей, используя метод Монте-Карло, и сравнить полученные приближённые результаты с точным аналитическим значением.

---

## 2. Теоретическая часть

### 2.1. Постановка задачи

Даны три окружности:

| Обозначение | Центр (x, y) | Радиус |
|-------------|--------------|--------|
| C₁ | (1, 1) | 1 |
| C₂ | (1.5, 2) | √5 / 2 |
| C₃ | (2, 1.5) | √5 / 2 |

Требуется найти площадь пересечения этих трёх кругов.

### 2.2. Метод Монте-Карло

Метод Монте-Карло — это численный метод, основанный на использовании случайных чисел для решения различных задач. В данном случае метод применяется для приближённого вычисления площади сложной фигуры.

**Принцип работы:**
1. Выбирается прямоугольная область, полностью содержащая искомую фигуру.
2. В этой области генерируется большое количество случайных точек.
3. Подсчитывается количество точек, попавших внутрь фигуры.
4. Площадь фигуры оценивается по формуле:

$$
\hat S = \frac{M}{N} \cdot S_\text{rect}
$$

где:

- $N$ — общее число сгенерированных точек;
- $M$ — число точек, попавших внутрь фигуры;
- $S_\text{rect}$ — площадь прямоугольной области.

**Точность метода:**

Точность метода Монте-Карло пропорциональна $\frac{1}{\sqrt{N}}$, то есть для увеличения точности в 10 раз необходимо увеличить количество точек в 100 раз.

---

## 3. Алгоритм Монте-Карло

### 3.1. Описание алгоритма

1. **Инициализация:**
   - Задать три окружности с их параметрами (центр и радиус).
   - Определить прямоугольную область для генерации точек.

2. **Генерация случайных точек:**
   - Сгенерировать $N$ случайных точек с равномерным распределением в выбранной области.

3. **Проверка принадлежности:**
   - Для каждой точки проверить, находится ли она внутри всех трёх окружностей.
   - Точка принадлежит окружности, если выполняется условие:

$$
(x - x_c)^2 + (y - y_c)^2 \leq r^2
$$

4. **Вычисление площади:**
   - Подсчитать количество точек $M$, попавших в пересечение всех трёх кругов.
   - Вычислить приближённую площадь:

$$
\hat S = \frac{M}{N} \cdot S_\text{rect}
$$

### 3.2. Реализация

Алгоритм реализован на языке C++17. Основные функции:
- `isPointInCircle()` — проверка принадлежности точки кругу;
- `isPointInAllCircles()` — проверка принадлежности точки всем трём кругам;
- `getBoundingBox()` — вычисление ограничивающего прямоугольника;
- `monteCarlo()` — основная функция метода Монте-Карло.

---

## 4. Точное значение площади

Площадь пересечения трёх кругов вычисляется по аналитической формуле:

$$
S = S_T + S_{C_1} + 2S_{C_2} + 2S_{C_3}
$$

где:

- $S_T = 0.5$ — площадь прямоугольного треугольника с катетами 1;
- $S_{C_1} = 0.25 \pi - 0.5$;
- $S_{C_2} = S_{C_3} = 1.25 \arcsin(0.8) - 1$.

**Точное значение площади:**

$$
S_\text{exact} = 0.9445171859
$$

---

## 5. Результаты экспериментов

### 5.1. Параметры экспериментов

Были проведены эксперименты с двумя типами прямоугольных областей:

| Тип | Диапазон X | Диапазон Y | Площадь |
|-----|------------|------------|---------|
| **Wide** | [0.0, 3.12] | [0.0, 3.12] | ≈ 9.72 |
| **Tight** | [1.0, 2.0] | [1.0, 2.0] | = 1 |

Количество точек $N$ варьировалось от 100 до 100000 с шагом 500 (всего 201 значение).

### 5.2. Результаты для области Wide

| N | M | S_est | Абсолютная ошибка | Относительная ошибка |
|---|---|-------|-------------------|---------------------|
| 100 | 11 | 1.0708 | 0.1263 | 0.1337 |
| 600 | 50 | 0.8112 | 0.1333 | 0.1411 |
| 1100 | 97 | 0.8584 | 0.0861 | 0.0912 |
| 1600 | 155 | 0.9430 | 0.0015 | 0.0016 |
| 10000 | 977 | 0.9511 | 0.0065 | 0.0069 |
| 50000 | 4788 | 0.9322 | 0.0124 | 0.0131 |
| 100000 | 9666 | 0.9409 | 0.0036 | 0.0038 |

### 5.3. Результаты для области Tight

| N | M | S_est | Абсолютная ошибка | Относительная ошибка |
|---|---|-------|-------------------|---------------------|
| 100 | 83 | 0.8300 | 0.1145 | 0.1212 |
| 600 | 479 | 0.7983 | 0.1462 | 0.1548 |
| 1100 | 869 | 0.7900 | 0.1545 | 0.1636 |
| 1600 | 1234 | 0.7712 | 0.1733 | 0.1834 |
| 10000 | 7842 | 0.7842 | 0.1603 | 0.1697 |
| 50000 | 39208 | 0.7842 | 0.1603 | 0.1697 |
| 100000 | 78415 | 0.7842 | 0.1604 | 0.1698 |

### 5.4. Графики

Графики зависимости площади и относительной ошибки от количества точек представлены на рисунках ниже.

**График 1:** Зависимость площади от N (файл `plots/area_vs_n.png`)

**График 2:** Зависимость относительной ошибки от N (файл `plots/error_vs_n.png`)

---

## 6. Сравнение Wide и Tight

### 6.1. Анализ результатов

**Область Wide:**
- Площадь области: 9.72
- При малых $N$ результаты нестабильны, но при увеличении $N$ точность улучшается.
- При $N = 100000$ относительная ошибка составляет около 0.38%.
- Лучший результат при $N = 80000$: относительная ошибка 0.12%.

**Область Tight:**
- Площадь области: 1.0
- Результаты более стабильны, но систематически занижены.
- При всех значениях $N$ получается площадь около 0.78, что значительно меньше точного значения.
- Относительная ошибка составляет около 17%.

### 6.2. Выводы по сравнению

1. **Область Wide** даёт более точные результаты, так как содержит всю фигуру пересечения и имеет больший запас по краям.

2. **Область Tight** даёт заниженные результаты, вероятно, потому что не полностью покрывает область пересечения или имеет недостаточный запас для точной оценки.

3. При увеличении количества точек точность метода улучшается, что соответствует теоретическим ожиданиям:

$$
\sim \frac{1}{\sqrt{N}}
$$

4. Для достижения высокой точности (относительная ошибка < 1%) при использовании области Wide требуется $N \geq 10000$.

---

## 7. Выводы

1. Метод Монте-Карло успешно применён для вычисления площади пересечения трёх окружностей.

2. Точное значение площади составляет $S_\text{exact} = 0.9445171859$.

3. При использовании области **Wide** метод показывает хорошую точность: при $N = 100000$ относительная ошибка составляет около 0.38%.

4. Область **Tight** даёт менее точные результаты из-за возможного неполного покрытия области пересечения.

5. Точность метода увеличивается с ростом количества точек, что подтверждает теоретические предсказания.

6. Для практического применения метода Монте-Карло важно правильно выбирать область генерации точек, чтобы она полностью содержала искомую фигуру.

---

## 8. ID посылки Codeforces

**ID посылки:** 348740684

**Задача:** A1i. Задача трех кругов — реализация

---

## 9. Ссылка на GitHub-репозиторий

**Ссылка:** https://github.com/suprend/monte-carlo-a1

---

## Приложение

### Структура проекта

```
.
├── src/
│   ├── main.cpp          # Решение для Codeforces
│   └── experiments.cpp   # Код для экспериментов
├── data/
│   ├── results_wide.csv  # Результаты для области Wide
│   └── results_tight.csv # Результаты для области Tight
├── plots/
│   ├── area_vs_n.png     # График зависимости площади от N
│   └── error_vs_n.png    # График зависимости ошибки от N
├── notebooks/
│   ├── analysis.ipynb    # Jupyter notebook для анализа
│   └── build_plots.py    # Скрипт для построения графиков
└── report.md             # Данный отчёт
```

