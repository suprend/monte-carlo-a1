# Отчёт по лабораторной работе
## Вычисление площади пересечения трёх окружностей методом Монте-Карло

---

## 1. Цель работы

Вычислить площадь фигуры, образованной пересечением трёх заданных окружностей, используя метод Монте-Карло, и сравнить полученные приближённые результаты с точным аналитическим значением.

---

## 2. Теоретическая часть

### 2.1. Постановка задачи

Даны три окружности:

| Обозначение | Центр (x, y) | Радиус |
|-------------|--------------|--------|
| C₁ | (1, 1) | 1 |
| C₂ | (1.5, 2) | √5 / 2 |
| C₃ | (2, 1.5) | √5 / 2 |

Требуется найти площадь пересечения этих трёх кругов.

### 2.2. Метод Монте-Карло

Метод Монте-Карло — это численный метод, основанный на использовании случайных чисел для решения различных задач. В данном случае метод применяется для приближённого вычисления площади сложной фигуры.

**Принцип работы:**
1. Выбирается прямоугольная область, полностью содержащая искомую фигуру.
2. В этой области генерируется большое количество случайных точек.
3. Подсчитывается количество точек, попавших внутрь фигуры.
4. Площадь фигуры оценивается по формуле:

$$
\hat S = \frac{M}{N} \cdot S_\text{rect}
$$

где:

- $N$ — общее число сгенерированных точек;
- $M$ — число точек, попавших внутрь фигуры;
- $S_\text{rect}$ — площадь прямоугольной области.

**Точность метода:**

Точность метода Монте-Карло пропорциональна $\frac{1}{\sqrt{N}}$, то есть для увеличения точности в 10 раз необходимо увеличить количество точек в 100 раз.

---

## 3. Алгоритм Монте-Карло

### 3.1. Описание алгоритма

1. **Инициализация:**
   - Задать три окружности с их параметрами (центр и радиус).
   - Определить прямоугольную область для генерации точек.

2. **Генерация случайных точек:**
   - Сгенерировать $N$ случайных точек с равномерным распределением в выбранной области.

3. **Проверка принадлежности:**
   - Для каждой точки проверить, находится ли она внутри всех трёх окружностей.
   - Точка принадлежит окружности, если выполняется условие:

$$
(x - x_c)^2 + (y - y_c)^2 \leq r^2
$$

4. **Вычисление площади:**
   - Подсчитать количество точек $M$, попавших в пересечение всех трёх кругов.
   - Вычислить приближённую площадь:

$$
\hat S = \frac{M}{N} \cdot S_\text{rect}
$$

### 3.2. Реализация

Алгоритм реализован на языке C++17. Основные функции:
- `isPointInCircle()` — проверка принадлежности точки кругу;
- `isPointInAllCircles()` — проверка принадлежности точки всем трём кругам;
- `getBoundingBox()` — вычисление ограничивающего прямоугольника;
- `monteCarlo()` — основная функция метода Монте-Карло.

---

## 4. Точное значение площади

Площадь пересечения трёх кругов вычисляется по аналитической формуле:

$$
S = S_T + S_{C_1} + 2S_{C_2} + 2S_{C_3}
$$

где:

- $S_T = 0.5$ — площадь прямоугольного треугольника с катетами 1;
- $S_{C_1} = 0.25 \pi - 0.5$;
- $S_{C_2} = S_{C_3} = 1.25 \arcsin(0.8) - 1$.

**Точное значение площади:**

$$
S_\text{exact} = 0.9445171859
$$

---

## 5. Результаты экспериментов

### 5.1. Параметры экспериментов

Были проведены эксперименты с двумя типами прямоугольных областей:

| Тип | Диапазон X | Диапазон Y | Площадь |
|-----|------------|------------|---------|
| **Wide** | [0.0, 3.12] | [0.0, 3.12] | ≈ 9.72 |
| **Tight** | [2 - sqrt(5)/2, 2.0] | [2 - sqrt(5)/2, 2.0] | = 5/4 ≈ 1.25 |

Значение `2 - sqrt(5)/2 ≈ 0.882` совпадает с координатами крайних точек пересечения кривых C₂ и C₃, поэтому узкая область теперь полностью покрывает искомую фигуру.

Количество точек $N$ варьировалось от 100 до 100000 с шагом 500 (всего 201 значение).

### 5.2. Результаты для области Wide

| N | M | S_est | Абсолютная ошибка | Относительная ошибка |
|---|---|-------|-------------------|---------------------|
| 100 | 8 | 0.7788 | 0.1658 | 0.1755 |
| 600 | 55 | 0.8923 | 0.0522 | 0.0553 |
| 1100 | 101 | 0.8938 | 0.0507 | 0.0537 |
| 1600 | 153 | 0.9309 | 0.0137 | 0.0145 |
| 10000 | 988 | 0.9618 | 0.0172 | 0.0183 |
| 50000 | 4901 | 0.9542 | 0.0096 | 0.0102 |
| 100000 | 9729 | 0.9471 | 0.0025 | 0.0027 |

### 5.3. Результаты для области Tight

| N | M | S_est | Абсолютная ошибка | Относительная ошибка |
|---|---|-------|-------------------|---------------------|
| 100 | 77 | 0.9625 | 0.0180 | 0.0190 |
| 600 | 440 | 0.9167 | 0.0279 | 0.0295 |
| 1100 | 832 | 0.9455 | 0.0009 | 0.0010 |
| 1600 | 1236 | 0.9656 | 0.0211 | 0.0223 |
| 10000 | 7588 | 0.9485 | 0.0040 | 0.0042 |
| 50000 | 37872 | 0.9468 | 0.0023 | 0.0024 |
| 100000 | 75486 | 0.9436 | 0.0009 | 0.0010 |

### 5.4. Графики

Графики зависимости площади и относительной ошибки от количества точек представлены на рисунках ниже.

**График 1:** Зависимость площади от N (файл `plots/area_vs_n.png`)

**График 2:** Зависимость относительной ошибки от N (файл `plots/error_vs_n.png`)

---

## 6. Сравнение Wide и Tight

### 6.1. Анализ результатов

**Область Wide:**
- Площадь области: 9.72.
- Из-за большого количества «лишних» точек дисперсия оценок выше; при $N = 100000$ относительная ошибка держится около 0.27%.
- Минимальная наблюдаемая относительная ошибка $3.6 \cdot 10^{-5}$ достигалась при $N \approx 31600$, но такие попадания единичны.

**Область Tight:**
- Площадь области: $5/4 = 1.25$.
- После корректного выбора прямоугольника оценки перестали занижаться и быстро сходятся к $S_\text{exact}$.
- При $N = 100000$ относительная ошибка составляет всего $\approx 0.10\%$, а минимум $3.1 \cdot 10^{-6}$ наблюдался около $N = 77100$.
- На малых $N$ результаты всё ещё шумные, но ощутимо лучше wide-варианта.

### 6.2. Выводы по сравнению

1. **Корректный tight-прямоугольник** обеспечивает лучшую точность, поскольку почти каждая точка участвует в оценке фигуры.
2. **Wide-вариант** остаётся полезным как универсальное решение, но для относительной ошибки < 1% приходится поднимать $N$ до десятков тысяч.
3. У обеих стратегий экспериментально наблюдается закон $1/\sqrt{N}$: удвоение точности требует примерно четырёхкратного роста $N$.
4. Неверный выбор области приводит к систематической ошибке, поэтому геометрический анализ граничных точек обязателен перед запуском Монте-Карло.

---

## 7. Выводы

1. Метод Монте-Карло успешно применён для вычисления площади пересечения трёх окружностей.

2. Точное значение площади составляет $S_\text{exact} = 0.9445171859$.

3. При использовании области **Wide** относительная ошибка снижается до $\approx 0.27\%$ при $N = 10^5$, но дисперсия оценок остаётся заметной.

4. Исправленный **Tight** ($[2 - \sqrt{5}/2, 2] \times [2 - \sqrt{5}/2, 2]$) сходится быстрее: уже при $N = 5 \cdot 10^4$ ошибки падают ниже 0.25%.

5. Точность метода увеличивается с ростом количества точек в соответствии с законом $1/\sqrt{N}$.

6. Правильный выбор области генерации критичен: малейшее «обрезание» фигуры приводит к систематическому смещению оценки.

---

## 8. ID посылки Codeforces

**ID посылки:** 348740684

**Задача:** A1i. Задача трех кругов — реализация

---

## 9. Ссылка на GitHub-репозиторий

**Ссылка:** https://github.com/suprend/monte-carlo-a1

---

## Приложение

### Структура проекта

```
.
├── src/
│   ├── main.cpp          # Решение для Codeforces
│   └── experiments.cpp   # Код для экспериментов
├── data/
│   ├── results_wide.csv  # Результаты для области Wide
│   └── results_tight.csv # Результаты для области Tight
├── plots/
│   ├── area_vs_n.png     # График зависимости площади от N
│   └── error_vs_n.png    # График зависимости ошибки от N
├── notebooks/
│   ├── analysis.ipynb    # Jupyter notebook для анализа
│   └── build_plots.py    # Скрипт для построения графиков
└── report.md             # Данный отчёт
```
